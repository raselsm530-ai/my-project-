// register.js
import { auth, db } from "./firebase-config.js";
import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { ref, set } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

window.register = () => {
    const phone = document.getElementById("phone").value.trim();
    const password = document.getElementById("password").value.trim();
    const confirm = document.getElementById("cpassword").value.trim();
    const pin = document.getElementById("pin").value.trim();
    const refer = document.getElementById("refer").value.trim() || "NO-REF";

    if (!phone || !password || !confirm || !pin) {
        alert("à¦¸à¦¬ à¦˜à¦° à¦ªà§‚à¦°à¦£ à¦•à¦°à§à¦¨");
        return;
    }

    if (phone.length !== 11 || !phone.startsWith("01")) {
        alert("à¦¸à¦ à¦¿à¦• à¦®à§‹à¦¬à¦¾à¦‡à¦² à¦¨à¦®à§à¦¬à¦° à¦¦à¦¿à¦¨");
        return;
    }

    if (password !== confirm) {
        alert("à¦ªà¦¾à¦¸à¦“à§Ÿà¦¾à¦°à§à¦¡ à¦®à¦¿à¦²à¦›à§‡ à¦¨à¦¾");
        return;
    }

    if (pin.length !== 4) {
        alert("à§ª à¦¸à¦‚à¦–à§à¦¯à¦¾à¦° à¦ªà¦¿à¦¨ à¦¦à¦¿à¦¨");
        return;
    }

    const email = phone + "@app.com";

    createUserWithEmailAndPassword(auth, email, password)
        .then(userCred => {
            // Firebase DB à¦¤à§‡ user data save
            set(ref(db, "users/" + phone), {
                phone,
                balance: 0,
                withdrawPin: pin,
                refCode: refer,
                joined: new Date().toLocaleString()
            });
            alert("à¦°à§‡à¦œà¦¿à¦¸à§à¦Ÿà§à¦°à§‡à¦¶à¦¨ à¦¸à¦«à¦² ðŸ‘ à¦²à¦—à¦‡à¦¨ à¦•à¦°à§à¦¨");
            location.href = "login.html";
        })
        .catch(err => {
            alert("Error: " + err.message);
        });
};
